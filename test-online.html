<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Test - Jesse Portfolio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status-indicator {
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .status-success { background: #d4edda; color: #155724; }
    .status-warning { background: #fff3cd; color: #856404; }
    .status-error { background: #f8d7da; color: #721c24; }
    .test-button {
      background: #1937BF;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #0d2a8f;
    }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üîß Online Portfolio Diagnostic Tool</h1>
  
  <div class="test-card">
    <h2>üåç Platform Detection & Sync Availability</h2>
    <div id="environmentStatus"></div>
    <p style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 6px;">
      <strong>üí° Belangrijk:</strong> Netlify sync werkt alleen op <code>portfoliojessehielema.netlify.app</code>, 
      niet lokaal. Universal sync werkt overal!
    </p>
  </div>
  
  <div class="test-card">
    <h2>Storage Tests</h2>
    <div id="storageStatus"></div>
    <button class="test-button" onclick="testStorage()">Test Storage</button>
    <button class="test-button" onclick="clearAllData()">Clear All Data</button>
  </div>
  
  <div class="test-card">
    <h2>Sync Tests</h2>
    <div id="syncStatus"></div>
    <button class="test-button" onclick="testSync()">Test All Sync</button>
    <button class="test-button" onclick="simulateAdminUpdate()">Simulate Admin Update</button>
    <button class="test-button" onclick="testUniversalSync()">Test Universal Sync</button>
    <button class="test-button" onclick="testNetlifySync()">Test Netlify Sync</button>
  </div>
  
  <div class="test-card">
    <h2>Console Output</h2>
    <pre id="consoleOutput"></pre>
    <button class="test-button" onclick="clearConsole()">Clear Console</button>
  </div>

  <script src="safe-storage.js"></script>
  <script src="debug-online.js"></script>
  <script src="online-sync.js"></script>
  <script src="netlify-sync.js"></script>
  <script src="universal-sync.js"></script>
  <script src="platform-detector.js"></script>
  
  <script>
    let consoleMessages = [];
    
    // Capture console messages
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    
    console.log = function(...args) {
      consoleMessages.push('LOG: ' + args.join(' '));
      updateConsoleOutput();
      originalLog.apply(console, args);
    };
    
    console.error = function(...args) {
      consoleMessages.push('ERROR: ' + args.join(' '));
      updateConsoleOutput();
      originalError.apply(console, args);
    };
    
    console.warn = function(...args) {
      consoleMessages.push('WARN: ' + args.join(' '));
      updateConsoleOutput();
      originalWarn.apply(console, args);
    };
    
    function updateConsoleOutput() {
      const output = document.getElementById('consoleOutput');
      output.textContent = consoleMessages.slice(-20).join('\n'); // Show last 20 messages
      output.scrollTop = output.scrollHeight;
    }
    
    function clearConsole() {
      consoleMessages = [];
      updateConsoleOutput();
    }
    
    function showStatus(elementId, message, type = 'success') {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="status-indicator status-${type}">${message}</div>`;
    }
    
    function checkEnvironment() {
      const protocol = window.location.protocol;
      const isOnline = protocol === 'http:' || protocol === 'https:';
      const hostname = window.location.hostname;
      const isNetlify = hostname.includes('netlify.app') || hostname.includes('netlify.com');
      
      // Get universal sync platform detection
      const platform = window.universalSync ? window.universalSync.platform : 'unknown';
      
      let message = `Protocol: ${protocol}<br>`;
      message += `Hostname: ${hostname}<br>`;
      message += `Environment: ${isOnline ? 'Online (HTTP/HTTPS)' : 'Local (File)'}<br>`;
      message += `Netlify: ${isNetlify ? '‚úÖ Yes' : '‚ùå No'}<br>`;
      message += `Platform: ${platform}<br>`;
      
      if (window.universalSync) {
        message += '<br><strong>ÔøΩ Universal sync active!</strong>';
      }
      
      showStatus('environmentStatus', message, isOnline ? 'success' : 'warning');
    }
    
    function testStorage() {
      let results = [];
      
      // Test localStorage
      try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        results.push('‚úÖ localStorage: Working');
      } catch (e) {
        results.push('‚ùå localStorage: ' + e.message);
      }
      
      // Test sessionStorage
      try {
        sessionStorage.setItem('test', 'test');
        sessionStorage.removeItem('test');
        results.push('‚úÖ sessionStorage: Working');
      } catch (e) {
        results.push('‚ùå sessionStorage: ' + e.message);
      }
      
      // Test safeStorage
      try {
        if (window.safeStorage) {
          window.safeStorage.setItem('test', 'test');
          const value = window.safeStorage.getItem('test');
          window.safeStorage.removeItem('test');
          results.push('‚úÖ safeStorage: Working');
        } else {
          results.push('‚ùå safeStorage: Not available');
        }
      } catch (e) {
        results.push('‚ùå safeStorage: ' + e.message);
      }
      
      showStatus('storageStatus', results.join('<br>'), 'success');
    }
    
    function clearAllData() {
      if (window.safeStorage) {
        window.safeStorage.clearPortfolioData();
      }
      
      try {
        localStorage.clear();
        sessionStorage.clear();
      } catch (e) {
        console.error('Error clearing storage:', e);
      }
      
      showStatus('storageStatus', 'üßπ All data cleared', 'warning');
    }
    
    function testSync() {
      let results = [];
      
      // Test Universal Sync
      if (window.universalSync) {
        const status = window.universalSync.getStatus();
        results.push('‚úÖ universalSync: Available');
        results.push(`üåç Platform: ${status.platform}`);
        results.push(`üîß Active methods: ${status.activeMethods.join(', ')}`);
        results.push(`‚è±Ô∏è Last sync: ${status.lastSync}`);
        
        // Test manual trigger
        window.universalSync.forceUpdate();
        results.push('üîÑ Universal sync triggered');
      } else {
        results.push('‚ùå universalSync: Not available');
      }
      
      // Test other sync methods
      if (window.onlineSync) {
        results.push('‚úÖ onlineSync: Available');
        window.onlineSync.triggerUpdate();
      } else {
        results.push('‚ùå onlineSync: Not available');
      }
      
      // Test Netlify sync
      if (window.netlifySync) {
        results.push('‚úÖ netlifySync: Available');
        window.netlifySync.forceUpdate();
      } else {
        results.push('‚ÑπÔ∏è netlifySync: Not active');
      }
      
      showStatus('syncStatus', results.join('<br>'), 'success');
    }
    
    function simulateAdminUpdate() {
      const timestamp = Date.now().toString();
      
      if (window.safeStorage) {
        window.safeStorage.setItem('portfolioUpdated', timestamp);
        window.safeStorage.setItem('newPostAdded', 'true');
        window.safeStorage.setItem('lastPortfolioUpdate', timestamp);
        window.safeStorage.setItem('netlifyForceUpdate', timestamp);
        window.safeStorage.setItem('universalSyncTrigger', timestamp);
        
        // Trigger all sync methods
        if (window.universalSync) {
          window.universalSync.signalUpdate();
        }
        
        if (window.netlifySync) {
          window.netlifySync.signalUpdate();
        }
        
        showStatus('syncStatus', 'üì° Admin update simulated with timestamp: ' + timestamp + 
                   '<br>üåç Universal sync: ' + (window.universalSync ? 'Triggered' : 'Not available') +
                   '<br>üåê Netlify sync: ' + (window.netlifySync ? 'Triggered' : 'Not available'), 'success');
      } else {
        showStatus('syncStatus', '‚ùå Cannot simulate - safeStorage not available', 'error');
      }
    }
    
    function testUniversalSync() {
      if (window.universalSync) {
        const status = window.universalSync.getStatus();
        window.universalSync.forceUpdate();
        showStatus('syncStatus', 
          `üåç Universal sync test:<br>Platform: ${status.platform}<br>Methods: ${status.activeMethods.join(', ')}<br>Force update triggered!`, 
          'success');
      } else {
        showStatus('syncStatus', '‚ùå Universal sync not available', 'error');
      }
    }
    
    function testNetlifySync() {
      if (window.netlifySync) {
        window.netlifySync.forceUpdate();
        showStatus('syncStatus', 'üåê Netlify force update triggered!', 'success');
      } else {
        showStatus('syncStatus', '‚ÑπÔ∏è Netlify sync not available (not on netlify.app domain)', 'warning');
      }
    }
    
    // Initialize tests - checkEnvironment now handled by platform-detector.js
    window.addEventListener('DOMContentLoaded', function() {
      // checkEnvironment(); // Handled by platform-detector.js
      testStorage();
      testSync();
    });
  </script>
</body>
</html>
