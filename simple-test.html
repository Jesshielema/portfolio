<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Sync Test</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .test-box { border: 2px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 8px; }
    .success { border-color: #4CAF50; background: #f0fff0; }
    .error { border-color: #f44336; background: #fff0f0; }
    .warning { border-color: #ff9800; background: #fff8f0; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    .post-item { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>üîß Simple Sync Test</h1>
  
  <div class="test-box">
    <h2>üìä localStorage Check</h2>
    <button onclick="checkStorage()">Check Storage</button>
    <button onclick="clearStorage()">Clear Storage</button>
    <div id="storageResults"></div>
  </div>
  
  <div class="test-box">
    <h2>‚ûï Add Test Post</h2>
    <button onclick="addTestPost()">Add Test Post</button>
    <div id="addResults"></div>
  </div>
  
  <div class="test-box">
    <h2>üìã Saved Posts</h2>
    <button onclick="showPosts()">Show All Posts</button>
    <div id="postsResults"></div>
  </div>
  
  <div class="test-box">
    <h2>üîÑ Direct Sync Test</h2>
    <button onclick="testDirectSync()">Test Direct Sync</button>
    <button onclick="manualReload()">Manual Reload</button>
    <div id="syncResults"></div>
  </div>

  <script src="safe-storage.js"></script>
  <script src="direct-sync.js"></script>
  
  <script>
    function checkStorage() {
      const results = document.getElementById('storageResults');
      
      try {
        // Test localStorage availability
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        
        // Check portfolio data
        const portfolioPosts = localStorage.getItem('portfolioPosts');
        const parsedPosts = portfolioPosts ? JSON.parse(portfolioPosts) : [];
        
        results.innerHTML = `
          <div class="success">
            <h3>‚úÖ localStorage Working</h3>
            <p><strong>Portfolio Posts:</strong> ${parsedPosts.length} found</p>
            <pre>${JSON.stringify(parsedPosts, null, 2)}</pre>
          </div>
        `;
        
      } catch (e) {
        results.innerHTML = `
          <div class="error">
            <h3>‚ùå localStorage Error</h3>
            <p>${e.message}</p>
          </div>
        `;
      }
    }
    
    function clearStorage() {
      try {
        localStorage.removeItem('portfolioPosts');
        localStorage.removeItem('deletedDefaultPosts');
        localStorage.removeItem('overriddenDefaultPosts');
        localStorage.removeItem('newPostAdded');
        localStorage.removeItem('portfolioUpdated');
        
        document.getElementById('storageResults').innerHTML = `
          <div class="warning">
            <h3>üßπ Storage Cleared</h3>
            <p>All portfolio data removed from localStorage</p>
          </div>
        `;
        
      } catch (e) {
        document.getElementById('storageResults').innerHTML = `
          <div class="error">
            <h3>‚ùå Clear Failed</h3>
            <p>${e.message}</p>
          </div>
        `;
      }
    }
    
    function addTestPost() {
      try {
        const testPost = {
          id: Date.now(),
          title: "Test Post " + new Date().toLocaleTimeString(),
          description: "Dit is een test post gemaakt om sync te testen",
          category: "TEST",
          type: "Test",
          date: new Date().toISOString().split('T')[0],
          image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23e0e0e0'/%3E%3Ctext x='200' y='150' text-anchor='middle' fill='%23666' font-family='Arial' font-size='16'%3ETest Image%3C/text%3E%3C/svg%3E",
          images: ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23e0e0e0'/%3E%3Ctext x='200' y='150' text-anchor='middle' fill='%23666' font-family='Arial' font-size='16'%3ETest Image%3C/text%3E%3C/svg%3E"],
          featured: false
        };
        
        // Get existing posts
        let posts = JSON.parse(localStorage.getItem('portfolioPosts') || '[]');
        
        // Add new post
        posts.unshift(testPost);
        
        // Save back
        localStorage.setItem('portfolioPosts', JSON.stringify(posts));
        
        // Set update flags
        localStorage.setItem('newPostAdded', 'true');
        localStorage.setItem('portfolioUpdated', Date.now().toString());
        localStorage.setItem('lastPortfolioUpdate', Date.now().toString());
        
        document.getElementById('addResults').innerHTML = `
          <div class="success">
            <h3>‚úÖ Test Post Added</h3>
            <p><strong>Title:</strong> ${testPost.title}</p>
            <p><strong>ID:</strong> ${testPost.id}</p>
            <p><strong>Total Posts:</strong> ${posts.length}</p>
            <p>Update flags set for sync systems</p>
          </div>
        `;
        
      } catch (e) {
        document.getElementById('addResults').innerHTML = `
          <div class="error">
            <h3>‚ùå Add Failed</h3>
            <p>${e.message}</p>
          </div>
        `;
      }
    }
    
    function showPosts() {
      try {
        const posts = JSON.parse(localStorage.getItem('portfolioPosts') || '[]');
        const results = document.getElementById('postsResults');
        
        if (posts.length === 0) {
          results.innerHTML = `
            <div class="warning">
              <h3>üìù No Posts Found</h3>
              <p>No posts in localStorage. Add a test post first.</p>
            </div>
          `;
          return;
        }
        
        const postsHtml = posts.map((post, index) => `
          <div class="post-item">
            <strong>${index + 1}. ${post.title}</strong><br>
            <small>ID: ${post.id} | Date: ${post.date} | Category: ${post.category}</small><br>
            <em>${post.description}</em>
          </div>
        `).join('');
        
        results.innerHTML = `
          <div class="success">
            <h3>üìã Found ${posts.length} Posts</h3>
            ${postsHtml}
          </div>
        `;
        
      } catch (e) {
        document.getElementById('postsResults').innerHTML = `
          <div class="error">
            <h3>‚ùå Show Posts Failed</h3>
            <p>${e.message}</p>
          </div>
        `;
      }
    }
    
    function testDirectSync() {
      const results = document.getElementById('syncResults');
      
      if (window.directSync) {
        const status = window.directSync.getStatus();
        window.directSync.manualUpdate();
        
        results.innerHTML = `
          <div class="success">
            <h3>üéØ Direct Sync Test</h3>
            <p><strong>Active:</strong> ${status.active}</p>
            <p><strong>Saved Posts:</strong> ${status.savedPosts}</p>
            <p><strong>Current Posts:</strong> ${status.currentPosts}</p>
            <p><strong>Last Check:</strong> ${status.lastCheck}</p>
            <p>Manual update triggered!</p>
          </div>
        `;
      } else {
        results.innerHTML = `
          <div class="error">
            <h3>‚ùå Direct Sync Not Available</h3>
            <p>Direct sync script not loaded</p>
          </div>
        `;
      }
    }
    
    function manualReload() {
      window.location.reload();
    }
    
    // Auto-run storage check on load
    window.addEventListener('DOMContentLoaded', function() {
      checkStorage();
    });
  </script>
</body>
</html>
